const i=require("path"),n=require("commander");n.option("-d --debug").option("-c --config [config]").option("-l --limit [limit]","limit of assets",4).option("--no-minimize [minimize],","is minimize source").option("-v --views [views]").option("--no-clean").option("--watch").option("styleguidist").option("-res --resource").option("--report").parse(process.argv);var e=n.args[1];const l=n.debug;var s=n.config;const c=n.limit,p=n.minimize;var o=n.resource;const u=function e(r,t){let i={};for(let o in r){let s=r[o];var n;"[object Object]"===Object.prototype.toString.call(s)?(n=e(s,t),"{}"!==JSON.stringify(n)&&(i[o]=n)):t?t.split(",").forEach(e=>{s.includes(e)&&(i[o]=s)}):i[o]=s}return i}(n.views?require(i.resolve(process.env.INIT_CWD,n.views)):{},e);s&&(process.env.VUE_CLI_SERVICE_CONFIG_PATH=require("path").resolve(process.env.INIT_CWD,s)),e&&process.argv.pop();["styleguidist","styleguidist:build"].includes(process.argv[2])?(process.VIEWS=u,process.argv[3]="--config",process.argv[4]="node_modules/vue-cli-plugin-vogter/styleguide.js",process.isRes=o,l&&console.log("styleguidist-process:\n",process.argv),module.exports=(e,s)=>{delete s.assetsDir,delete s.css}):module.exports=e=>{e.chainWebpack(o=>{if(n.views&&"{}"===JSON.stringify(u))throw new Error(`【${n.views}】中未匹配到任何视图`);var e="development"===process.env.NODE_ENV;const r=e=>{Object.entries(e).forEach(([e,s])=>{"!"!==e[0]&&(e=e.replace("!",""),"[object Object]"===Object.prototype.toString.call(s)?r(s):o.entry(e).add(s))})};l&&console.log("\nviews",u),r(u),"serve:frame"===process.env.npm_lifecycle_event&&(o.devServer.contentBase=[i.resolve("public"),i.resolve("frame")]),o.entryPoints.delete("app");const s=o.module.rule("js").exclude.values()[0],t=function(o){const e=o.map(e=>{if("string"==typeof o){const s=i.join("node_modules",o,"/");return"win32"===process.platform?s.replace(/\\/g,"\\\\"):s}if(e instanceof RegExp)return e.source});return e.length?new RegExp(e.join("|")):null}((process.env.npm_package_transpileDependencies||"").split(",").filter(Boolean));o.module.rule("js").exclude.clear().add(e=>{if(!0===s(e))return(!t||!t.test(e))&&/node_modules/.test(e)}),o.output.library(process.env.npm_package_library).libraryTarget("umd").filename("[name]").chunkFilename("[name]"),o.plugins.delete("html"),o.plugins.delete("prefetch"),o.plugins.delete("preload"),o.module.rules.delete("pug"),o.module.rules.delete("postcss"),o.module.rules.delete("sass"),o.module.rules.delete("less"),o.module.rules.delete("stylus"),o.module.rules.delete("docs"),o.module.rule("images").use("url-loader").loader("url-loader").tap(e=>Object.assign(e,{limit:1024*c})),o.plugins.delete("copy"),e||o.optimization.minimize(p),e||o.performance.maxAssetSize(1048576).maxEntrypointSize(1048576),o.optimization.splitChunks({minSize:10485760,minChunks:1024,cacheGroups:{vendors:!1,default:!1}}),l&&console.log("\nwebpackConf",o)})};